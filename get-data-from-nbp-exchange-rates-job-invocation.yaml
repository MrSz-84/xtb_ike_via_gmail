main:
  params: [input]
  steps:
    - init:
        assign:
          - project_id:     ${sys.get_env("GOOGLE_CLOUD_PROJECT_ID")}
          - job_name:       ${input.jobName}
          - job_location:   ${input.jobLocation}
          - manual_period:  ${if(input.p == true, true, false)}
          - dates:          ${if(input.d != null, input.d, [])}
          - script:         ${input.scriptName}
    - pick_args:
        assign:
            - job_args: ${if(manual_period, [script, "-p", "-d", dates[0], dates[1]], [script, "-l"])}
    - run_job:
        call: googleapis.run.v1.namespaces.jobs.run
        args:
          name:     ${"namespaces/" + project_id + "/jobs/" + job_name}
          location: ${job_location}
          body:
            overrides:
                containerOverrides:
                    args: ${job_args}
        result: run_result
    - finish:
        return: ${run_result.status}
