main:
  params: [input]
  steps:
    - init:
        assign:
          - project_id:     ${sys.get_env("GOOGLE_CLOUD_PROJECT_ID")}
          - job_name:       ${input.jobName}
          - job_location:   ${input.jobLocation}
          - outputsize:     ${if(input.outputsize == "full", "full", "compact")}
          - script:         ${input.scriptName}
    - pick_args:
        assign:
            - job_args: ${[script, "--outputsize", outputsize]}
    - run_job:
        call: googleapis.run.v1.namespaces.jobs.run
        args:
          name:     ${"namespaces/" + project_id + "/jobs/" + job_name}
          location: ${job_location}
          body:
            overrides:
                containerOverrides:
                    args: ${job_args}
        result: run_result
    - finish:
        return: ${run_result.status}